<<<<<<< HEAD
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ميسور - مساعد ذكي</title>
    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/favicon.ico">
    <meta name="msapplication-TileImage" content="/favicon.ico">
    <meta name="msapplication-TileColor" content="#0D5C4A">
    <meta name="theme-color" content="#0D5C4A">
    <!-- Fonts and Styles -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <header class="header">
        <h1>ميسور</h1>
        <div class="header-controls">
            <button class="control-button" id="new-chat">
                <i class="fas fa-plus"></i>
                محادثة جديدة
            </button>
            <button class="control-button danger" id="clear-chat">
                <i class="fas fa-trash"></i>
                مسح المحادثة
            </button>
        </div>
    </header>

    <div class="chat-container">
        <div class="chat-messages" id="chat-messages">
            <div class="message ai-message">
                <div class="message-time">الآن</div>
                مرحباً! أنا ميسور، كيف يمكنني مساعدتك اليوم؟ 😊
            </div>
        </div>
        
        <div class="typing-indicator" id="typing-indicator">
            <span></span>
            <span></span>
            <span></span>
        </div>

        <div class="input-container">
            <div class="input-wrapper">
                <input type="text" id="message-input" placeholder="اكتب رسالتك هنا..." autocomplete="off">
                <div class="input-buttons">
                    <label for="image-upload" class="image-upload-button">
                        <i class="fas fa-image"></i>
                        <input type="file" id="image-upload" accept="image/*" style="display: none;">
                    </label>
                    <button id="send-button">
                        <i class="fas fa-paper-plane"></i>
                        إرسال
                    </button>
                </div>
            </div>
            <div id="image-preview" class="image-preview" style="display: none;">
                <img id="preview-image" src="" alt="Preview">
                <button id="remove-image" class="remove-image">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const chatMessages = document.getElementById('chat-messages');
        const typingIndicator = document.getElementById('typing-indicator');
        const newChatButton = document.getElementById('new-chat');
        const clearChatButton = document.getElementById('clear-chat');
        const toast = document.getElementById('toast');
        const imageUpload = document.getElementById('image-upload');
        const imagePreview = document.getElementById('image-preview');
        const previewImage = document.getElementById('preview-image');
        const removeImage = document.getElementById('remove-image');
        let currentImageData = null;

        function showToast(message, type = 'success') {
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
        }

        function addMessage(content, isUser) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
            
            const timeDiv = document.createElement('div');
            timeDiv.className = 'message-time';
            timeDiv.textContent = getCurrentTime();
            messageDiv.appendChild(timeDiv);
            
            if (isUser) {
                messageDiv.textContent = content;
            } else {
                messageDiv.innerHTML = content;
                
                // Add copy buttons to code blocks
                messageDiv.querySelectorAll('.code-block').forEach(block => {
                    const copyButton = document.createElement('button');
                    copyButton.className = 'copy-button';
                    copyButton.innerHTML = '<i class="fas fa-copy"></i>';
                    copyButton.onclick = () => {
                        const code = block.querySelector('.code-content').textContent;
                        navigator.clipboard.writeText(code).then(() => {
                            showToast('تم نسخ الكود بنجاح!');
                        });
                    };
                    block.appendChild(copyButton);
                });
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function startNewChat() {
            chatMessages.innerHTML = `
                <div class="message ai-message">
                    <div class="message-time">الآن</div>
                    مرحباً! أنا ميسور، كيف يمكنني مساعدتك اليوم؟ 😊
                </div>
            `;
            showToast('تم بدء محادثة جديدة');
        }

        function clearChat() {
            if (confirm('هل أنت متأكد من مسح المحادثة بالكامل؟')) {
                startNewChat();
                showToast('تم مسح المحادثة', 'danger');
            }
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentImageData = e.target.result;
                    previewImage.src = currentImageData;
                    imagePreview.style.display = 'flex';
                };
                reader.readAsDataURL(file);
            }
        }

        function removeUploadedImage() {
            currentImageData = null;
            imagePreview.style.display = 'none';
            imageUpload.value = '';
        }

        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message && !currentImageData) return;

            addMessage(message, true);
            if (currentImageData) {
                const imageMessage = document.createElement('div');
                imageMessage.className = 'message user-message';
                imageMessage.innerHTML = `
                    <div class="message-time">${getCurrentTime()}</div>
                    <img src="${currentImageData}" alt="Uploaded image" class="uploaded-image">
                `;
                chatMessages.appendChild(imageMessage);
            }
            
            messageInput.value = '';
            typingIndicator.style.display = 'flex';
            chatMessages.scrollTop = chatMessages.scrollHeight;

            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        message: message,
                        image: currentImageData
                    }),
                });

                const data = await response.json();
                typingIndicator.style.display = 'none';
                addMessage(data.reply, false);
                removeUploadedImage();
            } catch (error) {
                typingIndicator.style.display = 'none';
                addMessage('عذراً، حدث خطأ في الاتصال. يرجى المحاولة مرة أخرى.', false);
                showToast('حدث خطأ في الاتصال', 'danger');
            }
        }

        // Event Listeners
        sendButton.addEventListener('click', sendMessage);
        newChatButton.addEventListener('click', startNewChat);
        clearChatButton.addEventListener('click', clearChat);
        imageUpload.addEventListener('change', handleImageUpload);
        removeImage.addEventListener('click', removeUploadedImage);

        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Auto-resize textarea
        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });
    </script>
</body>
</html>
=======
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ميسور - مساعد ذكي</title>
    <!-- Favicon -->
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <meta name="msapplication-TileImage" content="{{ url_for('static', filename='favicon.ico') }}">
    <meta name="msapplication-TileColor" content="#0D5C4A">
    <meta name="theme-color" content="#0D5C4A">
    <!-- Fonts and Styles -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <header class="header">
        <h1>ميسور</h1>
        <div class="header-controls">
            <button class="control-button" id="new-chat">
                <i class="fas fa-plus"></i>
                محادثة جديدة
            </button>
            <button class="control-button danger" id="clear-chat">
                <i class="fas fa-trash"></i>
                مسح المحادثة
            </button>
        </div>
    </header>

    <div class="chat-container">
        <div class="chat-messages" id="chat-messages">
            <div class="message ai-message">
                <div class="message-time">الآن</div>
                مرحباً! أنا ميسور، كيف يمكنني مساعدتك اليوم؟ 😊
            </div>
        </div>
        
        <div class="typing-indicator" id="typing-indicator">
            <span></span>
            <span></span>
            <span></span>
        </div>

        <div class="input-container">
            <div class="input-wrapper">
                <input type="text" id="message-input" placeholder="اكتب رسالتك هنا..." autocomplete="off">
                <div class="input-buttons">
                    <label for="image-upload" class="image-upload-button">
                        <i class="fas fa-image"></i>
                        <input type="file" id="image-upload" accept="image/*" style="display: none;">
                    </label>
                    <button id="send-button">
                        <i class="fas fa-paper-plane"></i>
                        إرسال
                    </button>
                </div>
            </div>
            <div id="image-preview" class="image-preview" style="display: none;">
                <img id="preview-image" src="" alt="Preview">
                <button id="remove-image" class="remove-image">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const chatMessages = document.getElementById('chat-messages');
        const typingIndicator = document.getElementById('typing-indicator');
        const newChatButton = document.getElementById('new-chat');
        const clearChatButton = document.getElementById('clear-chat');
        const toast = document.getElementById('toast');
        const imageUpload = document.getElementById('image-upload');
        const imagePreview = document.getElementById('image-preview');
        const previewImage = document.getElementById('preview-image');
        const removeImage = document.getElementById('remove-image');
        let currentImageData = null;

        function showToast(message, type = 'success') {
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
        }

        function addMessage(content, isUser) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
            
            const timeDiv = document.createElement('div');
            timeDiv.className = 'message-time';
            timeDiv.textContent = getCurrentTime();
            messageDiv.appendChild(timeDiv);
            
            if (isUser) {
                messageDiv.textContent = content;
            } else {
                messageDiv.innerHTML = content;
                
                // Add copy buttons to code blocks
                messageDiv.querySelectorAll('.code-block').forEach(block => {
                    const copyButton = document.createElement('button');
                    copyButton.className = 'copy-button';
                    copyButton.innerHTML = '<i class="fas fa-copy"></i>';
                    copyButton.onclick = () => {
                        const code = block.querySelector('.code-content').textContent;
                        navigator.clipboard.writeText(code).then(() => {
                            showToast('تم نسخ الكود بنجاح!');
                        });
                    };
                    block.appendChild(copyButton);
                });
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function startNewChat() {
            chatMessages.innerHTML = `
                <div class="message ai-message">
                    <div class="message-time">الآن</div>
                    مرحباً! أنا ميسور، كيف يمكنني مساعدتك اليوم؟ 😊
                </div>
            `;
            showToast('تم بدء محادثة جديدة');
        }

        function clearChat() {
            if (confirm('هل أنت متأكد من مسح المحادثة بالكامل؟')) {
                startNewChat();
                showToast('تم مسح المحادثة', 'danger');
            }
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentImageData = e.target.result;
                    previewImage.src = currentImageData;
                    imagePreview.style.display = 'flex';
                };
                reader.readAsDataURL(file);
            }
        }

        function removeUploadedImage() {
            currentImageData = null;
            imagePreview.style.display = 'none';
            imageUpload.value = '';
        }

        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message && !currentImageData) return;

            addMessage(message, true);
            if (currentImageData) {
                const imageMessage = document.createElement('div');
                imageMessage.className = 'message user-message';
                imageMessage.innerHTML = `
                    <div class="message-time">${getCurrentTime()}</div>
                    <img src="${currentImageData}" alt="Uploaded image" class="uploaded-image">
                `;
                chatMessages.appendChild(imageMessage);
            }
            
            messageInput.value = '';
            typingIndicator.style.display = 'flex';
            chatMessages.scrollTop = chatMessages.scrollHeight;

            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        message: message,
                        image: currentImageData
                    }),
                });

                const data = await response.json();
                typingIndicator.style.display = 'none';
                addMessage(data.reply, false);
                removeUploadedImage();
            } catch (error) {
                typingIndicator.style.display = 'none';
                addMessage('عذراً، حدث خطأ في الاتصال. يرجى المحاولة مرة أخرى.', false);
                showToast('حدث خطأ في الاتصال', 'danger');
            }
        }

        // Event Listeners
        sendButton.addEventListener('click', sendMessage);
        newChatButton.addEventListener('click', startNewChat);
        clearChatButton.addEventListener('click', clearChat);
        imageUpload.addEventListener('change', handleImageUpload);
        removeImage.addEventListener('click', removeUploadedImage);

        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Auto-resize textarea
        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });
    </script>
</body>
</html>
>>>>>>> a0bd5c6497c61b3228a5bee4e87d30b9f4d1be22
